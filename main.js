(()=>{"use strict";class t{constructor(t){if(!t)throw new Error("Элемент не существует");this.element=t}static saveProduct(e){e.target.closest(".popup").remove(),t.renderProducts()}static renderHint(t){for(const e of t){const t=e.offsetParent,s=document.createElement("div");s.classList.add("form__hint"),s.textContent=e.dataset.validityMessage,t.appendChild(s);const{top:o,left:r}=e.getBoundingClientRect();s.style.top=window.scrollY+o+e.offsetHeight/2-s.offsetHeight+"px",s.style.left=`${window.scrollX+r+e.offsetWidth}px`,s.style.fontSize="17px",s.style.color="red"}}static resetForm(t){const e=document.querySelector(".popup");t.target.classList.contains("form__reset")&&(t.preventDefault(),e.remove())}static completeForm(t){const e=document.querySelector(".form").elements,s=t.target.closest(".list__product").querySelector(".product__name").textContent,o=JSON.parse(localStorage.getItem(s));for(let t=0;t<e.length;t++)e[t].value=o[t].value}static deleteProduct(t){if(t.target.classList.contains("delete-button")){const e=t.target.closest(".list__product").querySelector(".product__name").textContent;t.target.closest(".list__product").remove(),localStorage.removeItem(e)}}static renderPopUp(){document.querySelector(".list").insertAdjacentHTML("beforeend",'<div class=popup><form action="" class="form" id="form"><div class="form__group"><label class="form__label" for="=name">Название</label><input type="text" class="form__name input" id="name" data-validity-message="Введите корректное значение" required=""></div><div class="form__group"><label class="form__label" for="price">Стоимость</label><input type="number" class="form__price input" id="price" min="1" data-validity-message="Введите корректное значение" min="1" required=""></div></form><div class="form__button-container"><button type="button" class="form__save form__button">Сохранить</button><button type="button" class="form__reset form__button">Отмена</button></div></div>')}static renderProduct(t){const e=document.querySelector(".list__table > tbody"),s=`<tr class="list__product"><th class="product__name">${t[0].value}</th><th class="product__price">${+t[1].value}</th><th><button type="button" class="change-button">&#9998</button><button type="button" class="delete-button">&#10006</button></th></tr>`;e.insertAdjacentHTML("beforeend",s)}static renderProducts(){const t=document.getElementsByClassName("list__product");for(const e of[...t])e.remove();const e=Object.keys(localStorage),s=document.querySelector(".list__table > tbody");for(const t of e){const e=`<tr class="list__product"><th class="product__name">${JSON.parse(localStorage.getItem(t))[0].value}</th><th class="product__price">${JSON.parse(localStorage.getItem(t))[1].value}</th><th><button type="button" class="change-button">&#9998</button><button type="button" class="delete-button">&#10006</button></th></tr>`;s.insertAdjacentHTML("beforeend",e)}}}class e{constructor(t){if(!t)throw new Error("Элемент не существует");this.element=t,e.startRender(),this.listenerOfAdd(),this.listenerOfSave(),this.listenerOfReset(),this.listenerOfСhange(),this.listenerOfDelete()}static startRender(){localStorage&&t.renderProducts()}listenerOfAdd(){this.element.addEventListener("click",(t=>e.add(t)))}static add(e){e.target.classList.contains("list__add-submit")&&(e.preventDefault(),t.renderPopUp())}listenerOfSave(){this.element.addEventListener("click",(t=>e.saveProduct(t)))}static saveProduct(s){if(s.target.classList.contains("form__save")){const o=s.target.closest(".popup").querySelector(".form"),r=[...o.elements].filter((t=>!t.validity.valid));try{e.checkInValidity(r)}catch(r){const n=[...o.elements].map((({id:t,value:e})=>({id:t,value:e})));e.saveData(n),t.saveProduct(s)}}}static checkInValidity(e){if(!e.length)throw new Error("проверка не нужна");t.renderHint(e)}static saveData(t){localStorage.setItem(`${t[0].value}`,JSON.stringify(t))}listenerOfReset(){this.element.addEventListener("click",(e=>t.resetForm(e)))}listenerOfСhange(){this.element.addEventListener("click",(t=>e.changeProduct(t)))}static changeProduct(e){e.target.classList.contains("change-button")&&(t.renderPopUp(),t.completeForm(e))}listenerOfDelete(){this.element.addEventListener("click",(e=>t.deleteProduct(e)))}}new e(document)})();